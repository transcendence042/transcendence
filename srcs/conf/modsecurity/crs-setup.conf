# -----------------------------------------------------------------------------
# OWASP CRS setup overrides (lightweight tuning starting point)
# -----------------------------------------------------------------------------

# Paranoia Level:
# 1 = safe defaults, 2/3/4 = more strict (more FPs to tune)
SecAction \
 "id:900000,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.paranoia_level=1"

# Inbound / Outbound Anomaly thresholds:
# Block when score >= threshold. Lower = stricter (more blocking).
SecAction \
 "id:900110,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.inbound_anomaly_score_threshold=5,\
  setvar:tx.outbound_anomaly_score_threshold=4"

# Enforce JSON and XML processors (ModSec body parsers already enabled in modsecurity.conf)
SecAction \
 "id:900200,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_exclusions_json=1,\
  setvar:tx.crs_exclusions_xml=1"

# Allowed HTTP methods for CRS (align with your custom allow-list in modsecurity.conf)
SecAction \
 "id:900300,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:'tx.allowed_methods=GET HEAD POST'"

# Allowed content types (tighten if you like; keep in sync with optional POST rule you may enable)
SecAction \
 "id:900220,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:'tx.allowed_request_content_type=|application/x-www-form-urlencoded|multipart/form-data|application/json|text/xml|application/xml|'"

# File extensions and request limits (tune to your app)
SecAction \
 "id:900230,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.max_num_args=256,\
  setvar:tx.arg_name_length=50,\
  setvar:tx.arg_length=64000,\
  setvar:tx.total_arg_length=64000,\
  setvar:tx.max_file_size=12000000,\
  setvar:tx.combined_file_sizes=12000000"
