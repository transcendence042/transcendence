# This rule blocks POST, PUT, PATCH, or DELETE requests to /api/ endpoints (except /api/auth/login) if the X-CSRF-Token header is missing.
# It helps enforce CSRF protection for state-changing API operations.
SecRule REQUEST_METHOD "@rx ^(?:POST|PUT|PATCH|DELETE)$" "id:900500,phase:2,deny,status:403,log,msg:'CSRF token missing',chain"
SecRule REQUEST_URI "@beginsWith /api/" "t:none,chain"
SecRule REQUEST_URI "!@streq %{tx.csrf_exclude}" "chain"
SecRule &REQUEST_HEADERS:%{tx.csrf_token_header} "@eq 0"
