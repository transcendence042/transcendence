# These rules block POST, PUT, PATCH, or DELETE requests to /api/ endpoints (except /api/auth/login)
# if the X-CSRF-Token header is missing. This enforces CSRF protection for state-changing API operations.
SecRule REQUEST_METHOD "@rx ^(?:POST|PUT|PATCH|DELETE)$" "id:900500,phase:2,deny,status:403,log,msg:'CSRF token missing: invalid method'"
SecRule REQUEST_URI "@beginsWith /api/" "id:900501,phase:2,deny,status:403,log,msg:'CSRF token missing: invalid endpoint'"
SecRule REQUEST_URI "!@streq /api/auth/login" "id:900502,phase:2,deny,status:403,log,msg:'CSRF token missing: login excluded'"
SecRule &REQUEST_HEADERS:X-CSRF-Token "@eq 0" "id:900503,phase:2,deny,status:403,log,msg:'CSRF token missing: header not present'"
