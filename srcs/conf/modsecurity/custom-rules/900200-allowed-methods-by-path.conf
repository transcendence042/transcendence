# 900200 — Allowed methods by path (defaults + per-endpoint overrides)

#1) Only GET/HEAD in root (SPA frontend)
SecRule REQUEST_URI "^/$" \ 
"id:900200,phase:1,deny,status:405,t:none,chain,msg:'Method not allowed in /'" 
SecRule REQUEST_METHOD "!@rx ^(?:GET|HEAD)$"

#2) In /api/ only GET/HEAD/POST by default
SecRule REQUEST_URI "@beginsWith /api/" \ 
"id:900201,phase:1,deny,status:405,t:none,chain,msg:'Method not allowed in /api/'" 
SecRule REQUEST_METHOD "!@rx ^(?:GET|HEAD|POST)$"

# ---------------------------
# OVERRIDES per endpoint
# ---------------------------
# Example A: /api/profiles — also allow PUT and DELETE
# (1) remove REQUEST_METHOD from rule 900201 for this route
SecRule REQUEST_URI "^/api/profiles$" \
"id:900202,phase:1,pass,ctl:ruleRemoveTargetById=900201;REQUEST_METHOD"

# (2) define the exact set of methods allowed in /api/profiles
SecRule REQUEST_URI "^/api/profiles$" \
"id:900203,phase:1,deny,status:405,t:none,chain,msg:'Method not allowed on /api/profiles'" 
SecRule REQUEST_METHOD "!@rx ^(?:GET|HEAD|POST|PUT|DELETE)$"

# Example B: /api/items and /api/items/{id} — allow PUT/DELETE
SecRule REQUEST_URI "^/api/items(?:/\d+)?$" \ 
"id:900204,phase:1,pass,ctl:ruleRemoveTargetById=900201;REQUEST_METHOD"

SecRule REQUEST_URI "^/api/items(?:/\d+)?$" \ 
"id:900205,phase:1,deny,status:405,t:none,chain,msg:'Method not allowed on /api/items'" 
SecRule REQUEST_METHOD "!@rx ^(?:GET|HEAD|POST|PUT|DELETE)$"

# Note: If any endpoint requires PATCH, add PATCH to the method regex for that route.