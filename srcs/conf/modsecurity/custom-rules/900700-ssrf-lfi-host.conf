# SSRF to private/metadata IPs
SecRule ARGS|REQUEST_URI "(?i)\b(?:https?|ftp|gopher|dict|ldap|ldaps|smb|file)://(?:%{tx.private_ip_regex})\b" \
  "id:900700,phase:2,deny,log,status:403,t:urlDecodeUni,t:lowercase,msg:'Possible SSRF to private/metadata IP'"

# Suspicious schemes
SecRule ARGS|REQUEST_URI "(?i)\b(?:%{tx.bad_schemes}):" \
  "id:900701,phase:2,deny,log,status:403,t:urlDecodeUni,t:lowercase,msg:'Suspicious scheme (SSRF/LFI vector)'"

# LFI quick wins
SecRule ARGS "(?i)%{tx.lfi_paths}" \
  "id:900702,phase:2,deny,log,status:403,t:urlDecodeUni,t:lowercase,t:normalizePath,msg:'LFI attempt (system file path)'"

# Host header sanity
SecRule REQUEST_HEADERS:Host "!@rx ^(?:%{tx.allowed_hostnames})(?::\d+)?$" \
  "id:900703,phase:1,deny,log,status:400,t:lowercase,msg:'Invalid Host header'"

# Strict POST Content-Type
SecRule REQUEST_METHOD "POST" \
  "id:900704,phase:1,chain,deny,log,status:415,msg:'Unsupported Content-Type for POST'"
  SecRule REQUEST_HEADERS:Content-Type "!@rx ^(?:%{tx.allowed_post_ct})(?:;|$)" "t:none,t:lowercase"
