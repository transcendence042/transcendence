# This rule blocks requests to /api/upload unless Content-Type is multipart/form-data.
# It enforces that only standard file uploads are accepted.
SecRule REQUEST_URI "@rx ^/api/upload" "id:900302,phase:1,deny,status:415,log,chain,msg:'Only multipart in /api/upload'"
SecRule REQUEST_HEADERS:Content-Type "!@rx ^%{tx.upload_content_type}(?:;|$)" "t:none"

# This rule blocks requests to /api/upload with a body larger than 8 MB.
# It helps prevent abuse and denial of service via large uploads.
SecRule REQUEST_URI "@rx ^/api/upload" "id:900303,phase:2,deny,status:413,log,chain,msg:'Upload too large in /api/upload'"
SecRule REQUEST_BODY_LENGTH "@gt %{tx.upload_max_size}"

