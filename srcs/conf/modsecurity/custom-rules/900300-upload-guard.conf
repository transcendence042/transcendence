# Block dangerous extensions in filenames (multipart)
SecRule FILES_NAMES "@rx \.(?:php\d?|phtml|phar|exe|dll|jsp|asp|aspx|sh|bat|cmd|com|js)$" \
"id:900300,phase:2,deny,status:403,msg:'Dangerous file extension on upload'"

# Block common double extensions (e.g. image.jpg.php)
SecRule FILES_NAMES "@rx \.(?:jpe?g|png|gif|svg|webp)\.(?:php\d?|phtml|phar|exe|js|jsp|asp|aspx)$" \
"id:900301,phase:2,deny,status:403,msg:'Double extension on upload'"

# Limit /api/upload to images (MIME declared by the client, be careful)
SecRule REQUEST_URI "^/api/upload" "id:900302,phase:2,deny,status:415,log,chain,msg:'Only images in /api/upload'"
SecRule REQUEST_HEADERS:Content-Type "!@rx ^multipart/form-data\b"

# (Optional) Specific size limit for /api/upload (other than tx.combined_file_sizes)
SecRule REQUEST_URI "^/api/upload" "id:900303,phase:2,deny,status:413,log,chain,msg:'Upload too large in /api/upload'"
SecRule REQUEST_BODY_LENGTH "@gt 8000000"