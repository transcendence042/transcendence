# This rule blocks API responses to /api/ endpoints unless the Content-Type header is application/json or application/problem+json for most HTTP status codes.
# It enforces that successful and most error responses from the API are always in JSON format.
SecRule REQUEST_URI "@beginsWith /api/" "id:900221,phase:3,deny,log,status:406,msg:'API must return JSON',chain"
SecRule RESPONSE_STATUS "@rx ^(?:2\d\d|3\d\d|4(?!13|29)\d\d)$" "chain"
SecRule RESPONSE_HEADERS:Content-Type "!@rx ^(?:%{tx.api_response_content_types})\b" "t:none"
